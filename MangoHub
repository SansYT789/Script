-- =================================
-- ðŸŸ£ MangoHub - Full Pack (Anti AFK + ESP Visual Client)
-- =================================

--// Load WindUI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

--// Anti AFK Settings
getgenv().AntiAFK_Mode = "auto"
getgenv().AntiAFK_Enabled = false
getgenv().AntiAFK_Connection = nil

--// ESP Settings
local ESPEnabled = false
local ESPFrames = {}

--// Helper Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

--// Láº¥y tÃªn pet
local function getRealPetName(eggModel)
    local val = eggModel:FindFirstChild("PetName")
    if val and val:IsA("StringValue") then
        return val.Value
    end
    return "Unknown"
end

--// Láº¥y egg gáº§n player trong radius
local function getPlayerGardenEggs(radius)
    local eggs = {}
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return eggs end

    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("PetName") then
            local primary = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
            if primary then
                local dist = (primary.Position - root.Position).Magnitude
                if dist <= (radius or 60) then
                    table.insert(eggs, obj)
                end
            end
        end
    end
    return eggs
end

--// Apply Billboard ESP
local function applyEggESP(egg)
    if ESPFrames[egg] or not ESPEnabled then return end

    local primary = egg.PrimaryPart or egg:FindFirstChildWhichIsA("BasePart")
    if not primary then return end

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "EggESP"
    billboard.Size = UDim2.new(0, 120, 0, 40)
    billboard.Adornee = primary
    billboard.AlwaysOnTop = true
    billboard.Parent = player:WaitForChild("PlayerGui")

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1,0,1,0)
    textLabel.BackgroundTransparency = 0.5
    textLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
    textLabel.Text = getRealPetName(egg)
    textLabel.TextColor3 = Color3.fromHex("#ff66aa")
    textLabel.TextScaled = true
    textLabel.Font = Enum.Font.GothamBold
    textLabel.Parent = billboard

    ESPFrames[egg] = billboard
end

--// Remove egg ESP
local function removeEggESP(egg)
    if ESPFrames[egg] then
        ESPFrames[egg]:Destroy()
        ESPFrames[egg] = nil
    end
end

--// Auto detect egg spawn/remove
Workspace.DescendantAdded:Connect(function(obj)
    if ESPEnabled and obj:IsA("Model") and obj:FindFirstChild("PetName") then
        applyEggESP(obj)
    end
end)
Workspace.DescendantRemoving:Connect(function(obj)
    if ESPFrames[obj] then
        removeEggESP(obj)
    end
end)

--// Main Window
local Window = WindUI:CreateWindow({
    Title = "MangoHub",
    Icon = "shield",
    Author = "Made By Group Vinreach",
    Folder = "Mango",
    Size = UDim2.fromOffset(450, 400),
    Theme = "Dark"
})

--// Sections & Tabs
local MainSection = Window:Section({ Title = "Main Features", Opened = true })
local ESPSection = Window:Section({ Title = "ESP / Misc", Opened = true })
local AntiAFKTab = MainSection:Tab({ Title = "Anti AFK", Icon = "shield", Desc = "Prevent AFK kick" })
local ESPTab = ESPSection:Tab({ Title = "ESP Eggs", Icon = "eye", Desc = "ESP Eggs + Pet Name" })

--// Anti AFK Tab
AntiAFKTab:Button({
    Title = "Toggle Anti AFK",
    Icon = "power",
    Variant = "Primary",
    Callback = function()
        getgenv().AntiAFK_Enabled = not getgenv().AntiAFK_Enabled
        local status = getgenv().AntiAFK_Enabled
        WindUI:Notify({ Title = "Anti AFK", Content = status and "Enabled" or "Disabled", Icon = status and "check" or "x", Duration = 3 })

        if status then
            local VirtualUser = game:GetService("VirtualUser")
            local Camera = Workspace.CurrentCamera
            local Player = Players.LocalPlayer

            if getgenv().AntiAFK_Connection then
                getgenv().AntiAFK_Connection:Disconnect()
            end

            getgenv().AntiAFK_Connection = Player.Idled:Connect(function()
                if not getgenv().AntiAFK_Enabled then return end
                local mode = getgenv().AntiAFK_Mode
                if mode == "auto" then
                    local modes = {"click","jump","rotate"}
                    mode = modes[math.random(1,#modes)]
                end

                if mode == "click" then
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton2(Vector2.new())
                elseif mode == "jump" then
                    local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.Jump = true end
                elseif mode == "rotate" then
                    if Camera then Camera.CFrame = Camera.CFrame * CFrame.Angles(0,math.rad(30),0) end
                end
            end)
        else
            if getgenv().AntiAFK_Connection then
                getgenv().AntiAFK_Connection:Disconnect()
                getgenv().AntiAFK_Connection = nil
            end
        end
    end
})

--// ESP Tab
ESPTab:Toggle({
    Title = "ESP Eggs + Pet Name",
    Desc = "Show nearby garden eggs and their pet names (Client Visual Only)",
    Value = false,
    Callback = function(state)
        ESPEnabled = state
        if ESPEnabled then
            for _, egg in pairs(getPlayerGardenEggs(60)) do
                applyEggESP(egg)
            end
        else
            for _, frame in pairs(ESPFrames) do
                if frame.Parent then frame:Destroy() end
            end
            ESPFrames = {}
        end
    end
})

--// Startup notification
WindUI:Notify({ Title = "MangoHub Loaded!", Content = "Anti AFK & ESP ready (Client Visual)", Icon = "check-circle", Duration = 3 })

--// Cleanup on close
Window:OnClose(function()
    if getgenv().AntiAFK_Connection then
        getgenv().AntiAFK_Connection:Disconnect()
        getgenv().AntiAFK_Connection = nil
    end
    for _, frame in pairs(ESPFrames) do
        if frame.Parent then frame:Destroy() end
    end
    ESPFrames = {}
end)
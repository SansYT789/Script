-- =================================
-- ðŸŸ£ MangoHub - Anti AFK + ESP Pets & Eggs
-- =================================

--// Load WindUI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

--// Global vars
getgenv().AntiAFK_Mode = "auto"
getgenv().AntiAFK_Enabled = false
getgenv().AntiAFK_Connection = nil
getgenv().EggESP_Enabled = false
getgenv().PetESP_Enabled = false

--// Window
local Window = WindUI:CreateWindow({
    Title = "MangoHub",
    Icon = "shield",
    Author = "Made By Group Vinreach",
    Folder = "Mango",
    Size = UDim2.fromOffset(450, 400),
    Theme = "Dark"
})

--// Sections
local MainSection = Window:Section({ Title = "Main Features", Opened = true })
local SettingsSection = Window:Section({ Title = "Settings", Opened = true })
local MiscSection = Window:Section({ Title = "Misc", Opened = true })

--// Tabs
local MainTab = MainSection:Tab({ Title = "Main", Icon = "house" })
local AutoTab = MainSection:Tab({ Title = "Automatic", Icon = "mouse-pointer-click" })
local ConfigTab = SettingsSection:Tab({ Title = "Configuration", Icon = "settings" })
local MiscTab = MiscSection:Tab({ Title = "ESP", Icon = "eye" })

-- =========================
-- Main Tab (Anti AFK)
-- =========================
MainTab:Paragraph({
    Title = "Anti AFK",
    Desc = "Prevent being kicked for idling",
    Image = "shield",
    Color = Color3.fromHex("#00ffcc")
})

MainTab:Toggle({
    Title = "Enable Anti AFK",
    Desc = "Turn Anti AFK on or off",
    Value = false,
    Callback = function(state)
        getgenv().AntiAFK_Enabled = state

        if state then
            if getgenv().AntiAFK_Connection then getgenv().AntiAFK_Connection:Disconnect() end
            local vu = game:GetService("VirtualUser")
            getgenv().AntiAFK_Connection = game:GetService("Players").LocalPlayer.Idled:Connect(function()
                if getgenv().AntiAFK_Mode == "auto" then
                    vu:CaptureController()
                    vu:ClickButton2(Vector2.new())
                elseif getgenv().AntiAFK_Mode == "jump" then
                    local char = game.Players.LocalPlayer.Character
                    if char and char:FindFirstChild("Humanoid") then
                        char.Humanoid.Jump = true
                    end
                end
            end)

            WindUI:Notify({Title = "Anti AFK", Content = "Enabled successfully!", Icon = "check", Duration = 3})
        else
            if getgenv().AntiAFK_Connection then getgenv().AntiAFK_Connection:Disconnect() end
            WindUI:Notify({Title = "Anti AFK", Content = "Disabled!", Icon = "x", Duration = 3})
        end
    end
})

-- =========================
-- Automatic Tab
-- =========================
AutoTab:Paragraph({Title = "Automatic Mode", Desc = "Choose how the Anti AFK works", Image = "zap", Color = Color3.fromHex("#ffaa00")})
AutoTab:Dropdown({
    Title = "Anti AFK Mode",
    Desc = "Select AFK method",
    Values = {"auto","jump"},
    Callback = function(val)
        getgenv().AntiAFK_Mode = val
        WindUI:Notify({Title = "Anti AFK Mode", Content = "Changed to: "..val, Icon = "zap", Duration = 3})
    end
})

-- =========================
-- Config Tab
-- =========================
ConfigTab:Paragraph({Title = "Configuration", Desc = "Save or Delete UI config", Image = "settings", Color = Color3.fromHex("#00aaff")})
ConfigTab:Button({Title = "Save Config", Desc = "Save all UI settings", Callback = function() WindUI:SaveConfig() WindUI:Notify({Title="Config",Content="Saved successfully!",Icon="check",Duration=3}) end})
ConfigTab:Button({Title = "Delete Config", Desc = "Delete saved UI config", Callback = function() WindUI:DeleteConfig() WindUI:Notify({Title="Config",Content="Deleted successfully!",Icon="trash",Duration=3}) end})

-- =========================
-- Misc Tab (ESP Eggs + Pets)
-- =========================
local ws = game.Workspace
local petMap = {}

-- --- Egg ESP ---
local function getPetName(model)
    local v = model:FindFirstChild("PetName")
    return v and v.Value or "???"
end

local function makeEggESP(model)
    if not getgenv().EggESP_Enabled or not model:IsA("Model") then return end
    if model:FindFirstChild("PetBillboard", true) then return end

    local part = model:FindFirstChildWhichIsA("BasePart")
    if not part then return end

    local bb = Instance.new("BillboardGui")
    bb.Name = "PetBillboard"
    bb.Size = UDim2.new(0, 200, 0, 40)
    bb.StudsOffset = Vector3.new(0, 3, 0)
    bb.AlwaysOnTop = true
    bb.Parent = part

    local lbl = Instance.new("TextLabel", bb)
    lbl.Size = UDim2.new(1, 0, 1, 0)
    lbl.BackgroundTransparency = 1
    lbl.Font = Enum.Font.FredokaOne
    lbl.Text = "ðŸ¥š " .. getPetName(model)
    lbl.TextColor3 = Color3.fromRGB(255, 255, 0)
    lbl.TextStrokeTransparency = 0.2
end

MiscTab:Toggle({
    Title = "Enable Egg ESP",
    Desc = "Show real pet names inside eggs",
    Value = false,
    Callback = function(state)
        getgenv().EggESP_Enabled = state
        if not state then
            for _, bb in pairs(ws:GetDescendants()) do
                if bb:IsA("BillboardGui") and bb.Name == "PetBillboard" then
                    bb:Destroy()
                end
            end
        end
    end
})

-- --- Pet ESP ---
local function applyPetESP(petModel)
    if not getgenv().PetESP_Enabled or not petModel:IsA("Model") then return end
    if petMap[petModel] then return end

    local part = petModel:FindFirstChildWhichIsA("BasePart")
    if not part then return end

    local bb = Instance.new("BillboardGui")
    bb.Name = "PetESP"
    bb.Size = UDim2.new(0, 200, 0, 30)
    bb.StudsOffset = Vector3.new(0, 3, 0)
    bb.AlwaysOnTop = true
    bb.Parent = part

    local lbl = Instance.new("TextLabel", bb)
    lbl.Size = UDim2.new(1,0,1,0)
    lbl.BackgroundTransparency = 1
    lbl.TextScaled = true
    lbl.Font = Enum.Font.GothamBold
    lbl.TextColor3 = Color3.fromRGB(255, 182, 193)
    lbl.TextStrokeTransparency = 0.2
    lbl.Text = petModel.Name
    petMap[petModel] = bb
end

local function scanPets()
    for _, obj in pairs(ws:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") then
            if string.find(obj.Name:lower(), "pet") then
                applyPetESP(obj)
            end
        end
    end
end

MiscTab:Toggle({
    Title = "Enable Pet ESP",
    Desc = "Highlight all pets with names",
    Value = false,
    Callback = function(state)
        getgenv().PetESP_Enabled = state
        if state then
            task.spawn(function()
                while getgenv().PetESP_Enabled do
                    scanPets()
                    task.wait(2)
                end
            end)
        else
            for _, bb in pairs(petMap) do
                if bb and bb.Parent then bb:Destroy() end
            end
            petMap = {}
        end
    end
})

-- =========================
-- RenderStepped Loop
-- =========================
game:GetService("RunService").RenderStepped:Connect(function()
    if getgenv().EggESP_Enabled then
        for _, egg in pairs(ws:GetDescendants()) do
            if egg:IsA("Model") and egg:FindFirstChild("PetName") then
                makeEggESP(egg)
            end
        end
    end
    if getgenv().PetESP_Enabled then
        scanPets()
    end
end)
-- =================================
-- üü£ MangoHub - Full Pack (Anti AFK + ESP Visual Client)
-- =================================

--// Load WindUI
local WindUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/dist/main.lua"))()

--// Anti AFK Settings
getgenv().AntiAFK_Mode = "auto"
getgenv().AntiAFK_Enabled = false
getgenv().AntiAFK_Connection = nil

--// ESP Settings
local ESPEnabled = false
local ESPFrames = {}

--// Load Pet GUI (Visual Client Only)
local G2L = require(path_to_ui_file) -- Thay b·∫±ng ƒë∆∞·ªùng d·∫´n t·ªõi UiPet script c·ªßa b·∫°n
local ScreenGui = G2L
ScreenGui.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui") -- Ch·ªâ client th·∫•y

--// Helper Services
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

--// Safe function l·∫•y v·ªã tr√≠ egg, tr√°nh crash khi kh√¥ng c√≥ PrimaryPart
local function getEggPosition(eggModel)
    local sum = Vector3.new(0,0,0)
    local count = 0
    for _, p in pairs(eggModel:GetDescendants()) do
        if p:IsA("BasePart") then
            sum = sum + p.Position
            count = count + 1
        end
    end
    if count == 0 then
        return eggModel:GetModelCFrame().Position -- fallback safe
    end
    return sum / count
end

--// L·∫•y t√™n pet
local function getRealPetName(eggModel)
    local val = eggModel:FindFirstChild("PetName")
    if val and val:IsA("StringValue") then
        return val.Value
    end
    return "Unknown"
end

--// L·∫•y egg g·∫ßn player trong radius
local function getPlayerGardenEggs(radius)
    local eggs = {}
    local char = player.Character or player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    if not root then return eggs end

    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("PetName") then
            local dist = (getEggPosition(obj) - root.Position).Magnitude
            if dist <= (radius or 60) then
                table.insert(eggs, obj)
            end
        end
    end
    return eggs
end

--// Apply ESP GUI
local function applyEggESP(egg)
    if ESPFrames[egg] or not ESPEnabled then return end

    local clone = ScreenGui.UiPet:Clone()
    clone.NameEgg.Text = egg.Name
    clone.NamePet.Text = getRealPetName(egg)
    clone.Parent = ScreenGui
    ESPFrames[egg] = clone

    spawn(function()
        local cam = Workspace.CurrentCamera
        while clone.Parent and ESPEnabled and egg.Parent do
            local pos, onScreen = cam:WorldToViewportPoint(getEggPosition(egg))
            clone.Position = UDim2.new(0, pos.X, 0, pos.Y)
            clone.Visible = onScreen
            clone.NamePet.Text = getRealPetName(egg) -- update realtime
            task.wait(0.03)
        end
        if clone.Parent then clone:Destroy() end
        ESPFrames[egg] = nil
    end)
end

--// Auto detect egg m·ªõi spawn/remove
Workspace.DescendantAdded:Connect(function(obj)
    if ESPEnabled and obj:IsA("Model") and obj:FindFirstChild("PetName") then
        applyEggESP(obj)
    end
end)
Workspace.DescendantRemoving:Connect(function(obj)
    if ESPFrames[obj] then
        ESPFrames[obj]:Destroy()
        ESPFrames[obj] = nil
    end
end)

--// Main Window
local Window = WindUI:CreateWindow({
    Title = "MangoHub",
    Icon = "shield",
    Author = "Made By Group Vinreach",
    Folder = "Mango",
    Size = UDim2.fromOffset(450, 400),
    Theme = "Dark"
})

--// Sections & Tabs
local MainSection = Window:Section({ Title = "Main Features", Opened = true })
local SettingsSection = Window:Section({ Title = "Settings", Opened = true })
local ESPSection = Window:Section({ Title = "Misc", Opened = true })

local MainTab = MainSection:Tab({ Title = "Main", Icon = "home", Desc = "Main info & links" })
local AntiAFKTab = MainSection:Tab({ Title = "Anti AFK", Icon = "shield", Desc = "Prevent AFK kick" })
local ConfigTab = SettingsSection:Tab({ Title = "Config", Icon = "settings", Desc = "UI settings" })
local ESPTab = ESPSection:Tab({ Title = "ESP", Icon = "eye", Desc = "ESP Eggs + Pet Name" })

--// Main Tab
MainTab:Paragraph({ Title = "Version: 1.0 [ Demo ]", Desc = "MangoHub - Visual ESP Only", Image = "info", ImageSize = 18, Color = Color3.fromHex("#30ff6a") })
MainTab:Divider()
MainTab:Button({
    Title = "Join Discord",
    Icon = "message-circle",
    Variant = "Primary",
    Callback = function()
        setclipboard("https://discord.gg/vinreach")
        WindUI:Notify({ Title = "Discord Link Copied!", Content = "Paste link in browser", Icon = "clipboard", Duration = 4 })
    end
})
MainTab:Paragraph({ Title = "Features", Desc = "‚Ä¢ Anti AFK\n‚Ä¢ Multiple Modes\n‚Ä¢ ESP Eggs + Pet Name (Client Visual Only)\n‚Ä¢ Auto detect spawn/remove\n‚Ä¢ Real-time update", Image = "list", ImageSize = 16, Color = Color3.fromHex("#667eea") })

--// Anti AFK Tab
AntiAFKTab:Button({
    Title = "Toggle Anti AFK",
    Icon = "power",
    Variant = "Primary",
    Callback = function()
        getgenv().AntiAFK_Enabled = not getgenv().AntiAFK_Enabled
        local status = getgenv().AntiAFK_Enabled
        WindUI:Notify({ Title = "Anti AFK", Content = status and "Enabled" or "Disabled", Icon = status and "check" or "x", Duration = 3 })
        print("‚úÖ Anti AFK: " .. tostring(status))

        if status then
            local VirtualUser = game:GetService("VirtualUser")
            local Camera = workspace.CurrentCamera
            local Player = Players.LocalPlayer

            if getgenv().AntiAFK_Connection then
                getgenv().AntiAFK_Connection:Disconnect()
            end

            getgenv().AntiAFK_Connection = Player.Idled:Connect(function()
                if not getgenv().AntiAFK_Enabled then return end
                local mode = getgenv().AntiAFK_Mode
                if mode == "auto" then
                    local modes = {"click","jump","rotate"}
                    mode = modes[math.random(1,#modes)]
                end

                if mode == "click" then
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton2(Vector2.new())
                elseif mode == "jump" then
                    local humanoid = Player.Character and Player.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid then humanoid.Jump = true end
                elseif mode == "rotate" then
                    if Camera then Camera.CFrame = Camera.CFrame * CFrame.Angles(0,math.rad(30),0) end
                end
            end)
        else
            if getgenv().AntiAFK_Connection then
                getgenv().AntiAFK_Connection:Disconnect()
                getgenv().AntiAFK_Connection = nil
            end
        end
    end
})

--// Config Tab
ConfigTab:Paragraph({ Title = "UI Customization", Desc = "Adjust interface settings", Image = "palette", ImageSize = 16, Color = Color3.fromHex("#667eea") })
ConfigTab:Dropdown({
    Title = "Theme",
    Values = {"Dark","Light"},
    Value = "Dark",
    Callback = function(theme)
        WindUI:SetTheme(theme)
        WindUI:Notify({ Title = "Theme Changed", Content = "Switched to "..theme, Icon = "palette", Duration = 2 })
    end
})
ConfigTab:Toggle({
    Title = "Show Notifications",
    Desc = "Enable system notifications",
    Value = true,
    Callback = function(state)
        WindUI:Notify({ Title = "Notifications", Content = state and "Enabled" or "Disabled", Duration = 2 })
    end
})

--// ESP Tab
ESPTab:Toggle({
    Title = "ESP Eggs + Pet Name",
    Desc = "Show nearby garden eggs and their pet names (Client Visual Only)",
    Value = false,
    Callback = function(state)
        ESPEnabled = state
        if ESPEnabled then
            for _, egg in pairs(getPlayerGardenEggs(60)) do
                applyEggESP(egg)
            end
        else
            for _, frame in pairs(ESPFrames) do
                if frame.Parent then frame:Destroy() end
            end
            ESPFrames = {}
        end
    end
})

--// Startup notification
WindUI:Notify({ Title = "MangoHub Loaded!", Content = "Anti AFK & ESP ready (Client Visual)", Icon = "check-circle", Duration = 3 })

--// Cleanup on close
Window:OnClose(function()
    if getgenv().AntiAFK_Connection then
        getgenv().AntiAFK_Connection:Disconnect()
        getgenv().AntiAFK_Connection = nil
    end